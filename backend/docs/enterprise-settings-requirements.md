# 企业设置功能需求文档

## 1. 功能概述

### 1.1 业务背景

企业设置是企业管理的核心功能，允许企业管理员配置企业的关键业务参数和权限控制策略。

### 1.2 目标用户

- 企业所有者 (Owner)
- 企业管理员 (Admin)

### 1.3 业务价值

- 提升企业管理灵活性
- 规范成员加入流程
- 控制企业信息可见性
- 优化通知管理体验

---

## 2. 功能需求

### 2.1 企业设置页面

#### 2.1.1 页面结构

```
企业设置
├── 基本信息设置
│   ├── 企业名称
│   ├── 企业描述
│   ├── 联系邮箱
│   ├── 联系电话
│   └── 企业Logo
├── 权限与审批设置
│   ├── 成员加入审批
│   ├── 企业公开可见
│   └── 默认成员角色
└── 通知设置
    ├── 邮件通知
    ├── 新成员提醒
    └── 角色变更提醒
```

#### 2.1.2 页面路径

- 路由: `/enterprises/:id/settings`
- 菜单: 企业管理 > 设置

#### 2.1.3 权限控制

- 仅 Owner 和 Admin 可访问
- Owner 拥有所有设置权限
- Admin 拥有除转让企业外的所有权限

---

### 2.2 基本信息设置

#### 2.2.1 企业名称

- **字段名**: `name`
- **类型**: 文本输入
- **必填**: 是
- **验证规则**:
  - 长度: 2-100 字符
  - 不允许特殊字符: < > & \ "
  - 企业名称唯一性校验
- **提示文案**: "请输入企业名称，2-100个字符"

#### 2.2.2 企业描述

- **字段名**: `description`
- **类型**: 多行文本
- **必填**: 否
- **验证规则**:
  - 长度: 0-500 字符
- **提示文案**: "简要描述企业业务或特点"

#### 2.2.3 联系邮箱

- **字段名**: `contactEmail`
- **类型**: 邮箱输入
- **必填**: 否
- **验证规则**:
  - 标准邮箱格式
  - 最大长度: 255 字符
- **提示文案**: "企业对外联系邮箱"

#### 2.2.4 联系电话

- **字段名**: `contactPhone`
- **类型**: 电话输入
- **必填**: 否
- **验证规则**:
  - 支持国内手机号或座机
  - 座机格式: 区号-电话号码
- **提示文案**: "企业对外联系电话"

#### 2.2.5 企业Logo

- **字段名**: `logo_url`
- **类型**: 图片上传
- **必填**: 否
- **验证规则**:
  - 格式: JPG, PNG, SVG
  - 大小: 最大 5MB
  - 建议尺寸: 200x200px
- **提示文案**: "建议上传200x200像素的企业Logo"

---

### 2.3 权限与审批设置

#### 2.3.1 成员加入审批

- **字段名**: `requireApproval`
- **类型**: 开关 (Switch)
- **默认值**: `false`
- **业务逻辑**:
  - `true`: 成员加入需要 Owner/Admin 审批
  - `false`: 成员可直接加入
- **提示文案**: "开启后，新成员加入企业需要管理员审批"

#### 2.3.2 企业公开可见

- **字段名**: `allowPublicView`
- **类型**: 开关 (Switch)
- **默认值**: `true`
- **业务逻辑**:
  - `true`: 企业信息可被非成员查看
  - `false`: 仅企业成员可查看企业信息
- **提示文案**: "关闭后，企业信息仅对成员可见"

#### 2.3.3 默认成员角色

- **字段名**: `defaultMemberRole`
- **类型**: 单选 (Radio)
- **可选项**:
  - `member`: 普通成员
  - `viewer`: 观察者 (仅查看权限)
- **默认值**: `member`
- **业务逻辑**: 新加入成员的默认角色
- **提示文案**: "设置新成员加入时的默认角色权限"

---

### 2.4 通知设置

#### 2.4.1 邮件通知总开关

- **字段名**: `notificationSettings.emailEnabled`
- **类型**: 开关 (Switch)
- **默认值**: `true`
- **业务逻辑**:
  - `true`: 启用邮件通知
  - `false`: 关闭所有邮件通知
- **提示文案**: "开启后，系统将发送邮件通知"

#### 2.4.2 新成员提醒

- **字段名**: `notificationSettings.newMemberAlert`
- **类型**: 开关 (Switch)
- **默认值**: `true`
- **前置条件**: `emailEnabled` 为 `true`
- **业务逻辑**:
  - `true`: 新成员加入时通知 Owner/Admin
  - `false`: 不发送新成员通知
- **提示文案**: "新成员加入时通知管理员"

#### 2.4.3 角色变更提醒

- **字段名**: `notificationSettings.roleChangeAlert`
- **类型**: 开关 (Switch)
- **默认值**: `true`
- **前置条件**: `emailEnabled` 为 `true`
- **业务逻辑**:
  - `true`: 成员角色变更时通知相关人员
  - `false`: 不发送角色变更通知
- **提示文案**: "成员角色变更时发送通知"

---

## 3. 界面交互

### 3.1 表单布局

- 使用 Ant Design 的 Form 组件
- 分区块展示：基本信息、权限设置、通知设置
- 每个区块使用 Card 或 Divider 分隔

### 3.2 保存机制

- 支持分区块保存或整体保存
- 保存时显示 loading 状态
- 保存成功显示成功提示
- 保存失败显示错误信息和原因

### 3.3 权限提示

- 无权限用户访问时显示无权限页面
- 提示用户联系企业管理员

---

## 4. API 接口

### 4.1 现有接口

根据 `enterprise.ts` service 文件，目前缺少以下接口：

### 4.2 需新增接口

#### 4.2.1 获取企业设置

- **接口**: `GET /enterprises/:id/settings`
- **响应**: `EnterpriseSettings`

#### 4.2.2 更新企业设置

- **接口**: `PUT /enterprises/:id/settings`
- **请求体**: `EnterpriseSettings`
- **响应**: `EnterpriseDetail`

---

## 5. 数据结构

### 5.1 EnterpriseSettings 类型

已定义在 `types/enterprise.ts` 中：

```typescript
export interface EnterpriseSettings {
  /** 成员加入需要审批 */
  requireApproval?: boolean;
  /** 允许公开查看 */
  allowPublicView?: boolean;
  /** 默认成员角色 */
  defaultMemberRole?: EnterpriseRole;
  /** 通知设置 */
  notificationSettings?: {
    emailEnabled?: boolean;
    newMemberAlert?: boolean;
    roleChangeAlert?: boolean;
  };
}
```

---

## 6. 验收标准

### 6.1 功能验收

- [ ] Owner 和 Admin 可以访问企业设置页面
- [ ] 可以修改企业基本信息并保存
- [ ] 可以修改权限与审批设置并保存
- [ ] 可以修改通知设置并保存
- [ ] 表单验证规则生效
- [ ] 保存成功/失败有明确反馈

### 6.2 权限验收

- [ ] Member 和 Viewer 无法访问设置页面
- [ ] 无权限用户看到友好提示

### 6.3 兼容性验收

- [ ] 支持移动端响应式布局
- [ ] 表单在各种屏幕尺寸下正常显示

---

## 7. 附录

### 7.1 相关文档

- API 文档：`/docs/api/enterprise.md`
- 类型定义：`/src/types/enterprise.ts`
- 服务层：`/src/services/enterprise.ts`

### 7.2 参考页面

- 企业详情页：`/enterprises/:id`
- 企业列表页：`/enterprises`
- 成员管理页：`/enterprises/:id/members`

---

**文档版本**: 1.0  
**创建日期**: 2026-02-15  
**作者**: AI Assistant  
**状态**: 待开发
