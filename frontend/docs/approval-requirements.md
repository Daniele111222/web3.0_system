# 企业审批系统需求文档

## 文档信息

- **版本**: v1.0.0
- **创建日期**: 2024-12-14
- **状态**: 待开发
- **优先级**: P0 (最高优先级)

---

## 1. 概述

### 1.1 文档目的

本文档详细描述了IP-NFT企业管理系统中**审批工作流功能**的需求规格，包括审批流程设计、权限控制、API接口、前端界面及通知机制等。

### 1.2 背景

当前系统已实现企业创建和基础管理功能，但**缺乏完整的审批流程**。企业创建后需要经过审批才能正式运营，成员邀请也需要相应审批机制，以确保平台的合规性和安全性。

### 1.3 范围

**包含功能**:

- ✅ 企业创建审批流程
- ✅ 企业信息变更审批
- ✅ 成员加入审批
- ✅ 审批权限管理
- ✅ 审批通知机制
- ✅ 审批历史记录

**不包含功能**:

- ❌ 财务相关审批
- ❌ 多级审批流程（后续版本支持）
- ❌ 自定义审批模板

---

## 2. 业务流程

### 2.1 企业审批流程

```
┌─────────────────────────────────────────────────────────────┐
│                      企业审批业务流程                        │
└─────────────────────────────────────────────────────────────┘

   用户注册/登录
        │
        ▼
   ┌─────────┐
   │ 创建企业 │ ──────────────────────┐
   └────┬────┘                        │
        │                             │
        ▼                             │
   ┌─────────────┐                   │
   │ 状态: pending │                  │
   │ (审核中)     │                   │
   └──────┬──────┘                   │
          │                          │
          ▼                          │
   ┌──────────────┐                 │
   │ 系统管理员    │ ◄───────────────┘
   │ 审批操作     │     收到审批通知
   └──────┬───────┘
          │
          ├──────────┬──────────┐
          ▼          ▼          ▼
     ┌────────┐  ┌────────┐  ┌────────┐
     │ 通过   │  │ 拒绝   │  │ 退回   │
     └───┬────┘  └───┬────┘  └───┬────┘
         │           │           │
         ▼           ▼           ▼
    ┌─────────┐  ┌─────────┐  ┌─────────┐
    │ active  │  │inactive │  │ pending │
    │(运营中) │  │(已拒绝) │  │(修改中) │
    └─────────┘  └─────────┘  └─────────┘
```

### 2.2 成员加入审批流程

```
┌───────────────────────────────────────────────────────────┐
│                     成员邀请审批流程                        │
└───────────────────────────────────────────────────────────┘

   Owner/Admin
       │
       ▼
   ┌────────────┐
   │ 发起邀请   │───► 发送邀请邮件 ───► 被邀请人邮箱
   └─────┬──────┘
         │
         ▼
   ┌──────────────┐
   │ 状态: pending │
   │ (等待接受)   │
   └───────┬──────┘
           │
           ▼
    被邀请人点击链接
           │
           ├──────────┬──────────┐
           ▼          ▼          ▼
      ┌────────┐  ┌────────┐  ┌────────┐
      │ 接受   │  │ 拒绝   │  │ 忽略   │
      └───┬────┘  └───┬────┘  └───┬────┘
          │           │           │
          ▼           ▼           ▼
     ┌─────────┐  ┌─────────┐  ┌─────────┐
     │ active  │  │inactive │  │ pending │
     │(已加入) │  │(已拒绝) │  │(未处理) │
     │7天后过期│  │        │  │30天过期 │
     └─────────┘  └─────────┘  └─────────┘
```

---

## 3. 功能需求

### 3.1 审批管理模块

#### 3.1.1 待审批列表

**功能描述**: 系统管理员查看所有待审批的企业和成员申请

**详细需求**:

- ✅ 分页展示待审批列表（每页20条）
- ✅ 支持按类型筛选（企业/成员）
- ✅ 支持按申请人、申请时间筛选
- ✅ 支持按紧急程度排序
- ✅ 显示申请人基本信息和申请详情
- ✅ 一键审批操作（通过/拒绝/退回）
- ✅ 批量审批功能（选择多条记录批量操作）

**界面元素**:

- 表格列：申请人、类型、申请时间、状态、操作
- 筛选器：类型选择器、日期范围、搜索框
- 操作按钮：查看详情、通过、拒绝、退回
- 批量操作栏：全选、批量通过、批量拒绝

#### 3.1.2 审批详情页

**功能描述**: 查看单个申请的详细信息并进行审批操作

**详细需求**:

- ✅ 展示申请完整信息（申请人资料、申请内容、附件等）
- ✅ 展示审批历史（之前的审批记录和意见）
- ✅ 审批操作区（通过/拒绝/退回按钮）
- ✅ 审批意见输入框（必填，最少10个字符）
- ✅ 附件上传（支持图片/PDF，最大10MB）
- ✅ 快捷审批模板（常用审批意见快速选择）

**界面元素**:

- 左侧：申请人信息卡片、申请内容详情
- 右侧：审批操作面板、审批历史时间线
- 底部：审批意见输入框、附件上传区、提交按钮

#### 3.1.3 审批历史

**功能描述**: 查看所有已处理的审批记录

**详细需求**:

- ✅ 分页展示审批历史（每页20条）
- ✅ 支持按审批状态、审批类型、时间范围筛选
- ✅ 支持按审批人、申请人搜索
- ✅ 显示审批结果和审批意见
- ✅ 支持导出审批记录（Excel/PDF）
- ✅ 审批记录详情查看

**界面元素**:

- 表格列：审批编号、申请人、类型、审批人、审批时间、结果、操作
- 筛选器：状态选择器、类型选择器、日期范围、搜索框
- 操作按钮：查看详情、导出

### 3.2 企业审批流程

#### 3.2.1 企业创建审批

**触发条件**: 用户提交企业创建申请

**审批流程**:

1. 用户填写企业信息并提交
2. 系统验证数据完整性
3. 企业状态设为`pending`
4. 发送审批通知给系统管理员
5. 管理员查看申请并进行审批
6. 根据审批结果更新企业状态
7. 发送审批结果通知给申请人

**审批结果处理**:

- **通过**: 企业状态变为`active`，申请人成为Owner，发送欢迎邮件
- **拒绝**: 企业状态变为`inactive`，记录拒绝原因，发送拒绝邮件
- **退回**: 企业状态保持`pending`，要求申请人补充材料，发送退回通知

#### 3.2.2 企业信息变更审批

**触发条件**: Owner/Admin修改企业重要信息

**需要审批的字段**:

- 企业名称
- 企业法人代表
- 营业执照号码
- 企业地址（跨省变更）

**审批流程**:

1. Owner/Admin修改企业信息
2. 系统检测是否涉及关键字段变更
3. 如需审批，创建变更申请记录
4. 原信息保持不变，显示"审核中"状态
5. 管理员审批变更申请
6. 审批通过后更新企业信息

### 3.3 成员审批流程

#### 3.3.1 成员邀请审批

**触发条件**: Owner/Admin邀请新成员

**审批流程**:

1. Owner/Admin填写邀请信息（邮箱、角色）
2. 系统发送邀请邮件
3. 被邀请人点击链接查看邀请详情
4. 被邀请人选择接受/拒绝
5. 如接受，成员状态变为`active`
6. 发送通知给邀请人和被邀请人

**特殊情况处理**:

- 邀请链接7天后过期，需重新邀请
- 被邀请人已有账号直接加入，无账号需先注册
- 同一邮箱多次邀请，以最新邀请为准

#### 3.3.2 成员加入申请审批

**触发条件**: 用户主动申请加入企业

**审批流程**:

1. 用户搜索企业并点击"申请加入"
2. 填写申请理由和个人介绍
3. 系统创建加入申请记录
4. 通知企业Owner/Admin
5. Owner/Admin审批申请
6. 根据结果处理：通过则加入，拒绝则通知申请人

### 3.4 权限控制

#### 3.4.1 审批权限矩阵

| 操作             | Owner | Admin | System Admin |
| ---------------- | ----- | ----- | ------------ |
| 审批企业创建申请 | ❌    | ❌    | ✅           |
| 审批企业变更申请 | ❌    | ❌    | ✅           |
| 审批成员加入申请 | ✅    | ✅    | ✅           |
| 查看审批历史     | ✅    | ✅    | ✅           |
| 导出审批记录     | ❌    | ❌    | ✅           |

#### 3.4.2 数据权限控制

- **系统管理员**: 可查看所有企业的审批记录
- **企业Owner**: 只能查看本企业的审批记录
- **企业Admin**: 只能查看本企业的成员相关审批

---

## 4. 非功能需求

### 4.1 性能需求

- **审批列表加载**: 首屏渲染时间 < 2秒
- **审批操作响应**: 提交审批结果 < 1秒
- **并发处理**: 支持100个并发审批操作
- **历史记录查询**: 百万级数据查询 < 3秒

### 4.2 可用性需求

- **系统可用性**: 99.9%（全年停机时间 < 8.76小时）
- **数据备份**: 每日自动备份，保留30天
- **灾难恢复**: RTO < 4小时，RPO < 1小时

### 4.3 安全需求

- **数据传输**: 全程HTTPS加密
- **审批操作**: 关键操作需二次确认
- **敏感数据**: 审批意见中的敏感信息脱敏
- **审计日志**: 所有审批操作记录完整审计日志
- **防篡改**: 审批记录上链存证（可选）

### 4.4 扩展性需求

- **水平扩展**: 支持集群部署，动态扩缩容
- **插件机制**: 预留审批流程自定义扩展点
- **多租户**: 支持多企业独立审批配置

---

## 5. 接口设计

### 5.1 审批管理接口

#### 5.1.1 获取待审批列表

```http
GET /api/v1/approvals/pending
```

**请求参数**:

```json
{
  "page": 1,
  "pageSize": 20,
  "type": "enterprise", // enterprise | member
  "startDate": "2024-01-01",
  "endDate": "2024-12-31"
}
```

**响应示例**:

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "total": 156,
    "page": 1,
    "pageSize": 20,
    "items": [
      {
        "approvalId": "appr_123456",
        "type": "enterprise",
        "subType": "create", // create | update | join
        "applicant": {
          "userId": "user_789",
          "name": "张三",
          "email": "zhangsan@example.com",
          "avatar": "https://..."
        },
        "targetInfo": {
          "enterpriseId": "ent_456",
          "enterpriseName": "科技创新有限公司",
          "changes": {
            "name": { "old": "原名称", "new": "新名称" },
            "address": { "old": "原地址", "new": "新地址" }
          }
        },
        "status": "pending",
        "applyTime": "2024-12-14T10:30:00Z",
        "remarks": "申请理由...",
        "attachments": [
          {
            "fileId": "file_123",
            "fileName": "营业执照.pdf",
            "fileUrl": "https://..."
          }
        ]
      }
    ]
  }
}
```

#### 5.1.2 审批操作

```http
POST /api/v1/approvals/{approvalId}/action
```

**请求体**:

```json
{
  "action": "approve", // approve | reject | return
  "comment": "审批通过，符合平台要求",
  "attachments": [
    {
      "fileId": "file_456",
      "fileName": "审批附件.pdf"
    }
  ]
}
```

**响应示例**:

```json
{
  "code": 200,
  "message": "审批操作成功",
  "data": {
    "approvalId": "appr_123456",
    "action": "approve",
    "operator": {
      "userId": "admin_001",
      "name": "系统管理员",
      "role": "system_admin"
    },
    "actionTime": "2024-12-14T11:00:00Z",
    "comment": "审批通过，符合平台要求",
    "result": {
      "targetId": "ent_456",
      "targetType": "enterprise",
      "oldStatus": "pending",
      "newStatus": "active"
    }
  }
}
```

#### 5.1.3 获取审批历史

```http
GET /api/v1/approvals/history
```

**请求参数**:

```json
{
  "page": 1,
  "pageSize": 20,
  "type": "enterprise",
  "status": "approved", // approved | rejected | all
  "startDate": "2024-01-01",
  "endDate": "2024-12-31",
  "operatorId": "admin_001" // 按审批人筛选
}
```

#### 5.1.4 获取审批详情

```http
GET /api/v1/approvals/{approvalId}
```

**响应示例**:

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "approvalId": "appr_123456",
    "type": "enterprise_create",
    "status": "approved",
    "applicant": {
      /* 申请人信息 */
    },
    "targetInfo": {
      /* 目标详情 */
    },
    "applyTime": "2024-12-14T10:30:00Z",
    "processHistory": [
      {
        "step": 1,
        "action": "submit",
        "operator": {
          /* 申请人 */
        },
        "time": "2024-12-14T10:30:00Z",
        "comment": "提交企业创建申请"
      },
      {
        "step": 2,
        "action": "approve",
        "operator": {
          /* 审批人 */
        },
        "time": "2024-12-14T11:00:00Z",
        "comment": "审批通过，符合平台要求"
      }
    ]
  }
}
```

### 5.2 通知接口

#### 5.2.1 获取审批通知

```http
GET /api/v1/notifications/approvals
```

#### 5.2.2 标记通知已读

```http
PUT /api/v1/notifications/{notificationId}/read
```

---

## 6. 数据库设计

### 6.1 审批记录表 (approvals)

```sql
CREATE TABLE approvals (
    id VARCHAR(64) PRIMARY KEY COMMENT '审批ID',
    type VARCHAR(32) NOT NULL COMMENT '审批类型: enterprise_create, enterprise_update, member_join',
    sub_type VARCHAR(32) COMMENT '子类型',
    target_id VARCHAR(64) NOT NULL COMMENT '目标ID(企业ID或成员ID)',
    target_type VARCHAR(32) NOT NULL COMMENT '目标类型: enterprise, member',
    applicant_id VARCHAR(64) NOT NULL COMMENT '申请人ID',
    status VARCHAR(32) NOT NULL DEFAULT 'pending' COMMENT '状态: pending, approved, rejected, returned',
    current_step INT DEFAULT 1 COMMENT '当前步骤',
    total_steps INT DEFAULT 1 COMMENT '总步骤数',
    remarks TEXT COMMENT '申请备注',
    attachments JSON COMMENT '附件列表',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    completed_at TIMESTAMP NULL COMMENT '完成时间',

    INDEX idx_applicant_id (applicant_id),
    INDEX idx_target_id (target_id),
    INDEX idx_status (status),
    INDEX idx_type (type),
    INDEX idx_created_at (created_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='审批记录表';
```

### 6.2 审批流程记录表 (approval_processes)

```sql
CREATE TABLE approval_processes (
    id VARCHAR(64) PRIMARY KEY COMMENT '流程记录ID',
    approval_id VARCHAR(64) NOT NULL COMMENT '审批ID',
    step INT NOT NULL COMMENT '步骤序号',
    action VARCHAR(32) NOT NULL COMMENT '操作: submit, approve, reject, return, transfer',
    operator_id VARCHAR(64) NOT NULL COMMENT '操作人ID',
    operator_role VARCHAR(32) COMMENT '操作人角色',
    comment TEXT COMMENT '审批意见',
    attachments JSON COMMENT '附件',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '操作时间',

    INDEX idx_approval_id (approval_id),
    INDEX idx_operator_id (operator_id),
    INDEX idx_created_at (created_at),
    FOREIGN KEY (approval_id) REFERENCES approvals(id) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='审批流程记录表';
```

### 6.3 审批通知表 (approval_notifications)

```sql
CREATE TABLE approval_notifications (
    id VARCHAR(64) PRIMARY KEY COMMENT '通知ID',
    type VARCHAR(32) NOT NULL COMMENT '通知类型: approval_request, approval_result, approval_reminder',
    recipient_id VARCHAR(64) NOT NULL COMMENT '接收人ID',
    approval_id VARCHAR(64) COMMENT '关联审批ID',
    title VARCHAR(255) NOT NULL COMMENT '通知标题',
    content TEXT COMMENT '通知内容',
    is_read TINYINT DEFAULT 0 COMMENT '是否已读: 0-未读, 1-已读',
    read_at TIMESTAMP NULL COMMENT '阅读时间',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',

    INDEX idx_recipient_id (recipient_id),
    INDEX idx_approval_id (approval_id),
    INDEX idx_is_read (is_read),
    INDEX idx_created_at (created_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='审批通知表';
```

---

## 7. 界面原型

### 7.1 审批管理界面

```
┌─────────────────────────────────────────────────────────────────────────┐
│ 审批管理                                    [刷新] [导出] [批量操作 ▼]    │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐                   │
│  │ 全部     │ │ 待审批   │ │ 已通过   │ │ 已拒绝   │                   │
│  │  156    │ │  23 🔥  │ │  102    │ │  31    │                   │
│  └──────────┘ └──────────┘ └──────────┘ └──────────┘                   │
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────────┐│
│  │ 筛选: [类型 ▼] [状态 ▼] [时间范围 ▼]          🔍 搜索申请人...     ││
│  └─────────────────────────────────────────────────────────────────────┘│
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────────┐│
│  │ ☑ │ 审批编号      │ 类型      │ 申请人    │ 申请时间       │ 状态   ││
│  ├────┼───────────────┼───────────┼───────────┼────────────────┼────────┤│
│  │ ☐ │ APR202412001  │ 企业创建  │ 张三      │ 2024-12-14     │ 🔵待审 ││
│  │    │               │           │           │ 10:30          │        ││
│  ├────┼───────────────┼───────────┼───────────┼────────────────┼────────┤│
│  │ ☐ │ APR202412002  │ 成员加入  │ 李四      │ 2024-12-14     │ 🔵待审 ││
│  │    │               │           │           │ 11:15          │        ││
│  ├────┼───────────────┼───────────┼───────────┼────────────────┼────────┤│
│  │ ☐ │ APR202412003  │ 信息变更  │ 王五      │ 2024-12-14     │ 🟡退回 ││
│  │    │               │           │           │ 09:20          │        ││
│  └────┴───────────────┴───────────┴───────────┴────────────────┴────────┘│
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────────┐│
│  │ 显示 1-10 条，共 23 条              [1] [2] [3] ... [10] ▶          ││
│  └─────────────────────────────────────────────────────────────────────┘│
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### 7.2 审批详情弹窗

```
┌─────────────────────────────────────────────────────────────────────────┐
│ 审批详情                                          [✕]                  │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  ┌──────────────────────────────────┐ ┌───────────────────────────────┐│
│  │     审批信息                      │ │      申请人信息              ││
│  ├──────────────────────────────────┤ ├─────────────────────────────┤│
│  │ 审批编号: APR202412001            │ │ ┌───────┐                    ││
│  │ 审批类型: 企业创建                │ │ │       │ 张三             ││
│  │ 申请时间: 2024-12-14 10:30:00    │ │ │ 头像  │ zhangsan@       ││
│  │ 当前状态: 🔵 待审批               │ │ │       │ example.com    ││
│  │                                  │ │ └───────┘ 注册时间: 2024  ││
│  │ 优先级: ⭐ 高                    │ │                              ││
│  └──────────────────────────────────┘ └───────────────────────────────┘│
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────────┐│
│  │                        申请详情                                      ││
│  ├─────────────────────────────────────────────────────────────────────┤│
│  │                                                                     ││
│  │   企业名称: 科技创新有限公司                                        ││
│  │   企业描述: 专注于人工智能和区块链技术研发...                        ││
│  │   企业地址: 北京市海淀区中关村软件园A座18层                         ││
│  │   联系邮箱: contact@tech-innov.com                                  ││
│  │   联系电话: 010-88888888                                           ││
│  │   官方网站: https://www.tech-innov.com                               ││
│  │   所属行业: 科技/软件                                               ││
│  │   企业规模: 100-500人                                               ││
│  │                                                                     ││
│  │   📎 附件 (3):                                                      ││
│  │   ├─ 营业执照.pdf (2.3MB)                                          ││
│  │   ├─ 法人身份证.jpg (1.1MB)                                        ││
│  │   └─ 企业介绍.pptx (5.6MB)                                         ││
│  │                                                                     ││
│  └─────────────────────────────────────────────────────────────────────┘│
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────────┐│
│  │                      审批历史                                        ││
│  ├─────────────────────────────────────────────────────────────────────┤│
│  │                                                                     ││
│  │   ●──────────────────────────────────────────────────────────────   ││
│  │   │ 2024-12-14 10:30:00                                              ││
│  │   │ 申请人: 张三                                                     ││
│  │   │ 操作: 提交申请                                                   ││
│  │   │ 备注: 申请创建企业                                               ││
│  │   ●──────────────────────────────────────────────────────────────   ││
│  │                                                                     ││
│  │   [等待审批...]                                                     ││
│  │                                                                     ││
│  └─────────────────────────────────────────────────────────────────────┘│
│                                                                         │
│  ╔═════════════════════════════════════════════════════════════════════╗│
│  ║                        审批操作区                                   ║│
│  ╠═════════════════════════════════════════════════════════════════════╣│
│  ║                                                                     ║│
│  ║   审批意见 (必填, 最少10个字符):                                   ║│
│  ║   ┌─────────────────────────────────────────────────────────────┐   ║│
│  ║   │                                                             │   ║│
│  ║   │ 请输入审批意见...                                           │   ║│
│  ║   │                                                             │   ║│
│  ║   └─────────────────────────────────────────────────────────────┘   ║│
│  ║                                                                     ║│
│  ║   快捷模板: [✓ 通过，符合要求] [拒绝，信息不完整] [退回，需补充材料] ║│
│  ║                                                                     ║│
│  ║   附件上传 (可选，最大10MB):                                        ║│
│  ║   [📎 点击上传或拖拽文件到此处]                                     ║│
│  ║                                                                     ║│
│  ║   ┌──────────────────────────────────────────────────────────────┐  ║│
│  ║   │ ⚠️  确认提交审批结果？提交后将不可修改。                     │  ║│
│  ║   └──────────────────────────────────────────────────────────────┘  ║│
│  ║                                                                     ║│
│  ║        ┌──────────────┐  ┌──────────────┐  ┌──────────────┐       ║│
│  ║        │   ✅ 通过    │  │   ❌ 拒绝    │  │   ↩️ 退回    │       ║│
│  ║        └──────────────┘  └──────────────┘  └──────────────┘       ║│
│  ║                                                                     ║│
│  ╚═════════════════════════════════════════════════════════════════════╝│
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 8. 状态流转图

### 8.1 企业状态流转

```
┌────────────────────────────────────────────────────────────────────┐
│                        企业状态流转图                                 │
└────────────────────────────────────────────────────────────────────┘

                            用户创建企业
                                  │
                                  ▼
                        ┌─────────────────┐
                        │    pending      │◄─────────────────┐
                        │   (审核中)      │                  │
                        └────────┬────────┘                  │
                                 │                         │
            ┌────────────────────┼────────────────────┐    │
            │                    │                    │    │
            ▼                    ▼                    ▼    │
    ┌──────────────┐    ┌──────────────┐    ┌──────────────┐│
    │   approved   │    │   rejected   │    │   returned   ││
    │  (已批准)    │    │  (已拒绝)    │    │  (已退回)    ││
    └──────┬───────┘    └──────────────┘    └───────┬──────┘│
           │                                          │       │
           ▼                                          ▼       │
    ┌──────────────┐                           ┌──────────────┐│
    │    active    │                           │ 补充材料后重新 ││
    │   (运营中)   │                           │   提交申请    ││
    └──────────────┘                           └──────────────┘│
                                                               │
                                                               │
                        ┌──────────────┐                       │
                        │   inactive   │───────────────────────┘
                        │   (已停用)    │
                        └──────────────┘

状态说明:
┌──────────┬─────────────────────────────────────────────────────┐
│ 状态      │ 说明                                                │
├──────────┼─────────────────────────────────────────────────────┤
│ pending  │ 初始状态，等待审批                                  │
│ approved │ 审批通过，等待激活（对于企业创建，通过后自动active）  │
│ rejected │ 审批被拒绝，需要重新申请                            │
│ returned │ 退回补充材料，补充后可重新提交                      │
│ active   │ 正常运营状态                                        │
│ inactive │ 停用状态，可由owner或admin手动设置                  │
└──────────┴─────────────────────────────────────────────────────┘

状态流转规则:
1. pending → approved/rejected/returned (由管理员操作)
2. approved → active (自动流转)
3. returned → pending (用户补充材料后重新提交)
4. active → inactive (由owner/admin手动设置)
5. inactive → active (由owner/admin手动设置)
```

### 8.2 成员状态流转

```
┌────────────────────────────────────────────────────────────────────┐
│                        成员状态流转图                               │
└────────────────────────────────────────────────────────────────────┘

                        Owner/Admin发起邀请
                                  │
                                  ▼
                        ┌─────────────────┐
                        │    pending      │
                        │   (邀请中)      │
                        └────────┬────────┘
                                 │
            ┌────────────────────┼────────────────────┐
            │                    │                    │
            ▼                    ▼                    ▼
    ┌──────────────┐    ┌──────────────┐    ┌──────────────┐
    │   accepted   │    │   declined   │    │    expired   │
    │   (已接受)    │    │   (已拒绝)    │    │   (已过期)    │
    └──────┬───────┘    └──────────────┘    └──────────────┘
           │
           ▼
    ┌──────────────┐
    │    active    │
    │   (活跃)     │
    └──────┬───────┘
           │
    ┌──────┴──────┐
    │             │
    ▼             ▼
┌────────┐  ┌────────┐
│inactive│  │ removed│
│(已停用)│  │(已移除)│
└────────┘  └────────┘
```

---

## 9. 风险评估与应对

### 9.1 风险识别

| 风险项     | 风险等级 | 描述                                 | 应对措施                                                            |
| ---------- | -------- | ------------------------------------ | ------------------------------------------------------------------- |
| 审批延迟   | 高       | 管理员未能及时处理审批，影响用户体验 | 1. 设置审批超时提醒<br>2. 配置多级审批人<br>3. 支持紧急审批通道     |
| 权限滥用   | 高       | 管理员滥用审批权限                   | 1. 审批操作全程审计<br>2. 关键审批需二次确认<br>3. 定期权限审查     |
| 数据泄露   | 中       | 审批过程中敏感信息泄露               | 1. 敏感字段加密存储<br>2. 审批附件访问控制<br>3. 审批日志脱敏处理   |
| 系统性能   | 中       | 高并发审批场景下系统响应慢           | 1. 审批队列异步处理<br>2. 数据库读写分离<br>3. Redis缓存热点数据    |
| 业务连续性 | 低       | 审批系统故障影响业务流程             | 1. 微服务架构，服务隔离<br>2. 降级策略，快速失败<br>3. 定期灾备演练 |

### 9.2 应急预案

#### 9.2.1 审批系统故障

**故障现象**: 审批功能无法使用，用户无法提交或处理审批

**应急措施**:

1. 启动备用审批流程（人工邮件审批）
2. 发布公告告知用户系统维护
3. 技术团队紧急排查修复
4. 故障恢复后补录审批数据

#### 9.2.2 数据异常

**故障现象**: 审批数据不一致或丢失

**应急措施**:

1. 立即暂停相关审批功能
2. 从备份恢复数据
3. 数据修复期间使用纸质审批
4. 修复完成后进行数据校验

---

## 10. 附录

### 10.1 术语表

| 术语   | 英文          | 说明                                       |
| ------ | ------------- | ------------------------------------------ |
| 审批   | Approval      | 对企业创建、变更、成员加入等申请的审核过程 |
| 审批人 | Approver      | 具有审批权限的用户，通常是系统管理员       |
| 申请人 | Applicant     | 发起审批申请的用户                         |
| 审批流 | Approval Flow | 审批任务在各个环节间的流转过程             |
| 退回   | Return        | 审批人将申请退回给申请人补充材料           |
| 转交   | Transfer      | 审批人将审批任务转交给其他审批人           |

### 10.2 参考文档

- [RESTful API设计规范](./api-guidelines.md)
- [数据库设计规范](./db-guidelines.md)
- [前端开发规范](./frontend-guidelines.md)
- [安全开发规范](./security-guidelines.md)

### 10.3 变更历史

| 版本   | 日期       | 修改人   | 修改内容                         |
| ------ | ---------- | -------- | -------------------------------- |
| v1.0.0 | 2024-12-14 | 产品经理 | 初始版本，包含完整的审批功能需求 |

---

**文档结束**

---

_本文档由IP-NFT产品团队维护，如有疑问请联系产品经理或技术负责人。_
